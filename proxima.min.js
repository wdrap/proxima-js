/*! proxima-js 2020-04-24 */

!function(){"use strict";var g,s,u,h,v,c,w;function d(r){h[0]=r;for(var n=0;n<g.length-1;n++)for(var e=0;e<g[n+1];e++){for(var t=u[n][e],a=0;a<g[n];a++)t+=h[n][a]*s[n][e][a];h[n+1][e]=1/(1+Math.exp(-t))}return h[g.length-1]}function p(r){for(var n=h[h.length-1],e=0,t=0;t<n.length;t++)e+=Math.pow(r[t]-n[t],2);return.5*e}function y(r){for(var n=g.length-1;0<=n;n--)for(var e=0,t=g[n];e<t;e++){var a=0;if(n===g.length-1)a=r[e]-h[n][e];else for(var o=0;o<v[n+1].length;o++)a+=v[n+1][o]*s[n][o][e];v[n][e]=a*h[n][e]*(1-h[n][e])}}function _(r){for(var n=0;n<g.length-1;n++)for(var e=0;e<g[n+1];e++){u[n][e]+=v[n+1][e]*r;for(var t=0;t<g[n];t++)s[n][e][t]+=v[n+1][e]*r*h[n][t]}}function r(o){(o=o||{}).neural_network=o.neural_network||[2,3,1],o.learning_rate=o.learning_rate||.3;var i=o.max_iterations||15e3,l=o.cost_threshold||.005,f=o.log_after_x_iterations||0;return function(r){g=r.neural_network,s=new Array(g.length-2),u=new Array(g.length-2),h=new Array(g.length),v=new Array(g.length-1);for(var n=0,e=g.length;n<e;n++){h[n]=new Array(g[n]),v[n]=new Array(g[n]);for(var t=0,a=g[n];t<a;t++)h[n][t]=0,v[n][t]=0;if(n===e-1)break;u[n]=new Array(g[n+1]),s[n]=new Array(g[n+1]);for(var o=0;o<g[n+1];o++){u[n][o]=2*Math.random()-1,s[n][o]=new Array(g[n]);for(var i=0;i<g[n];i++)s[n][o][i]=2*Math.random()-1}}}(o),{train:function(r,n){w=n,console.time("training"),c=1;for(var e=0;e<i&&l<c;e++)for(var t=0,a=r.length;t<a;t++)d(r[t].inputs),c=p(r[t].targets),e%f==0&&console.timeLog("training","error: "+c),l<c&&(y(r[t].targets),_(o.learning_rate));console.timeLog("training","error: "+c,"iterations: "+e),console.timeEnd("training")},predict:function(r){var n=d(r),e=function(r,n){for(var e=parseFloat(n.toFixed(2)),t=new Array(r.length),a=0;a<r.length;a++)t[a]=r[a]<e/10||r[a]>e?Math.round(r[a]):r[a];return t}(n,c);return{outputs:n,flattened:e,labeled:function(r,n){for(var e=new Array(r.length),t=0;t<r.length;t++){if(void 0!==n&&1===r[t])return n[t];e[t]=!!r[t]}return e}(e,w)}},export:function(){return JSON.stringify({nn:g,weights:s,bias_weights:u,gradients:v,error:c,labels:w})},import:function(r){var n=JSON.parse(r);g=n.nn,s=n.weights,u=n.bias_weights,v=n.gradients,c=n.error,w=n.labels}}}"undefined"!=typeof exports&&module.exports?module.exports=r:this.Proxima=r}();